/*
 * buzzer_processing.c
 *
 *  Created on: Nov 25, 2023
 *      Author: PC
 */

#include "buzzer_processing.h"
#include "note.h"

int cnt = 0;

int sound [] = {
	NOTE_E7, NOTE_E7, 0, NOTE_E7,
	0, NOTE_C7, NOTE_E7, 0,
	NOTE_G7, 0, 0,  0,
	NOTE_G6, 0, 0, 0,

	NOTE_C7, 0, 0, NOTE_G6,
	0, 0, NOTE_E6, 0,
	0, NOTE_A6, 0, NOTE_B6,
	0, NOTE_AS6, NOTE_A6, 0,

	NOTE_G6, NOTE_E7, NOTE_G7,
	NOTE_A7, 0, NOTE_F7, NOTE_G7,
	0, NOTE_E7, 0, NOTE_C7,
	NOTE_D7, NOTE_B6, 0, 0,

	NOTE_C7, 0, 0, NOTE_G6,
	0, 0, NOTE_E6, 0,
	0, NOTE_A6, 0, NOTE_B6,
	0, NOTE_AS6, NOTE_A6, 0,

	NOTE_G6, NOTE_E7, NOTE_G7,
	NOTE_A7, 0, NOTE_F7, NOTE_G7,
	0, NOTE_E7, 0, NOTE_C7,
	NOTE_D7, NOTE_B6, 0, 0
};

const int soundDuration[] = {
  12, 12, 12, 12,
  12, 12, 12, 12,
  12, 12, 12, 12,
  12, 12, 12, 12,

  12, 12, 12, 12,
  12, 12, 12, 12,
  12, 12, 12, 12,
  12, 12, 12, 12,

  9, 9, 9,
  12, 12, 12, 12,
  12, 12, 12, 12,
  12, 12, 12, 12,

  12, 12, 12, 12,
  12, 12, 12, 12,
  12, 12, 12, 12,
  12, 12, 12, 12,

  9, 9, 9,
  12, 12, 12, 12,
  12, 12, 12, 12,
  12, 12, 12, 12
};

const int duration = sizeof(sound)/sizeof(sound[0]);

void buzzerRun() {
//	if (getFlagTimer(4)) {
//			setTimer(4, soundDuration[cnt]);
//			__HAL_TIM_SET_AUTORELOAD(&htim3, 1000000/sound[cnt]);
//			__HAL_TIM_SET_COMPARE(&htim3, TIM_CHANNEL_1, 15);
//			cnt++;
//			if (cnt >= duration)
//				cnt = 0;
//		}
	if (cnt < duration) {
//		__HAL_TIM_SET_AUTORELOAD(&htim3, 1000000/sound[cnt]);
//		__HAL_TIM_SET_COMPARE(&htim3, TIM_CHANNEL_1, 15);
		__HAL_TIM_SET_AUTORELOAD(&htim3, 700);
		__HAL_TIM_SET_COMPARE(&htim3, TIM_CHANNEL_1, 100-20*counter1);
		cnt++;
	}
	else
		cnt = 0;
}

void buzzerStop() {
	__HAL_TIM_SET_AUTORELOAD(&htim3, 0);
	__HAL_TIM_SET_COMPARE(&htim3, TIM_CHANNEL_1, 0);
//	setTimer(4, TIME_CYCLE);
//		cnt = 0;
}
